#BTT Ocotpus Pro With Coprint Kcm & ECM
#WARNING
#Setup now uses BTT eddy inplace of the omron sensor

[include chroma_head.cfg]
[include kcm.cfg]
[include ecm_1.cfg]
[include cp_macro.cfg]
[include input_shaper.cfg]
[include eddy.cfg]
#[include external_inputshaper.cfg]
[include mainsail.cfg]
[include config_backup.cfg]
[virtual_sdcard]

path: /home/pi/printer_data/gcodes
on_error_gcode: CANCEL_PRINT

[gcode_macro _CLIENT_VARIABLE]
variable_park_at_cancel   : True # allow to move the toolhead to park while execute CANCEL_PRINT [True/False]
variable_park_at_cancel_x : 250  # different park position during CANCEL_PRINT [None/Position as Float]; park_at_cancel must be True
variable_park_at_cancel_y : 260  # different park position during CANCEL_PRINT [None/Position as Float]; park_at_cancel must be True
variable_user_cancel_macro: "_SET_FILAMENT"
gcode:

[display_status]
[pause_resume]
[exclude_object]
[gcode_arcs]
[respond]

#[save_variables]
#filename: ~/variables.cfg
#   Required - provide a filename that would be used to save the
#   variables to disk e.g. ~/variables.cfg

[mcu]
serial: /dev/serial/by-id/usb-1a86_USB_Serial-if00-port0
restart_method: command

[delayed_gcode startup] 
initial_duration: 5
gcode:
    SYNC_EXTRUDER_MOTION EXTRUDER=ex1 MOTION_QUEUE=extruder
    SYNC_EXTRUDER_MOTION EXTRUDER=ex2 MOTION_QUEUE=
    SYNC_EXTRUDER_MOTION EXTRUDER=ex3 MOTION_QUEUE=
    SYNC_EXTRUDER_MOTION EXTRUDER=ex4 MOTION_QUEUE=
	#When ecm1 is active, uncomment the lines ex5, ex6, ex7, ex8
    SYNC_EXTRUDER_MOTION EXTRUDER=ex5 MOTION_QUEUE=
    SYNC_EXTRUDER_MOTION EXTRUDER=ex6 MOTION_QUEUE=
    SYNC_EXTRUDER_MOTION EXTRUDER=ex7 MOTION_QUEUE=
    SYNC_EXTRUDER_MOTION EXTRUDER=ex8 MOTION_QUEUE=

[input_shaper]
#shaper_freq_x: 87.6
#shaper_type_x: ei
shaper_freq_y: 50.2
shaper_type_y: ei

[printer]
kinematics: cartesian
max_velocity: 300
max_accel: 3000
max_z_velocity: 5
max_z_accel: 100


# Driver0
[stepper_x]
step_pin: PC12
dir_pin: PB3
enable_pin: !PD2
microsteps: 16
rotation_distance: 40
endstop_pin: PA13
position_min: -26
position_endstop: -26
position_max: 322
#max printable size 322
homing_speed: 50


# Driver1
[stepper_y]
step_pin: PC11
dir_pin: PA15
enable_pin: !PC10
microsteps: 16
rotation_distance: 40
endstop_pin: PB8
position_endstop: 0
position_max: 332
#max printable size 328
homing_speed: 50

[stepper_z]
step_pin: PC7
dir_pin: !PC9
enable_pin: !PC8
microsteps: 16
rotation_distance: 8
position_min: -5
endstop_pin: probe:z_virtual_endstop
position_max: 400
#may need to reduce to allow for top mounted extruders
homing_speed: 10

# Driver3
#[stepper_z1]
#step_pin: PG4
#dir_pin: PC1
#enable_pin: !PA0
#microsteps: 16
#rotation_distance: 8

[heater_bed]
heater_pin: PA5
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PC0
#control: pid
# NOTE: These settings are for PETG, thus 80C bed temperature.
#pid_Kp: 70.173
#pid_Ki: 1.418
#pid_Kd: 868.388
min_temp: 0
max_temp: 100


[temperature_sensor mcu_temp]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

[temperature_sensor raspberry_pi]
sensor_type: temperature_host
min_temp: 0
max_temp: 100

[controller_fan mcu_fan]
pin: PB0

[led top_LEDs]
white_pin: PB9
cycle_time: 0.005
initial_WHITE: 1.0


#[z_tilt]
#z_positions: -30,110
#  290,110 
#points: 0,110
#  200,110
#retries: 5
#retry_tolerance: 0.02 
#speed:120
#horizontal_move_z: 7

[screws_tilt_adjust]
screw1: 10, 45
screw1_name: Front Left
screw2: 180, 45
screw2_name: Front Right
screw3: 10, 215
screw3_name: Rear Left
screw4: 180, 215
screw4_name: Rear Right
horizontal_move_z: 7
screw_thread: CW-M3
#   The type of screw used for bed leveling, M3, M4, or M5, and the
#   rotation direction of the knob that is used to level the bed.
#   Accepted values: CW-M3, CCW-M3, CW-M4, CCW-M4, CW-M5, CCW-M5.
#   Default value is CW-M3 which most printers use. A clockwise
#   rotation of the knob decreases the gap between the nozzle and the
#   bed. Conversely, a counter-clockwise rotation increases the gap.



[safe_z_home]
home_xy_position: 150, 150 # Change coordinates to the center of your print bed
speed: 50
z_hop: 10               # Move up 10mm
z_hop_speed: 5

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 68.637
#*# pid_ki = 0.969
#*# pid_kd = 1214.881
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	-0.119194, -0.060427, -0.069201, -0.066492, -0.097231, -0.129873, -0.188069, -0.255295, -0.296860
#*# 	0.003245, 0.085413, 0.099248, 0.126581, 0.118613, 0.111596, 0.086951, 0.048639, -0.003662
#*# 	-0.179616, -0.063019, -0.046862, -0.026328, -0.016171, -0.028428, -0.059633, -0.079309, -0.110731
#*# 	-0.178993, -0.077126, -0.048158, -0.030608, -0.022133, -0.029348, -0.033841, -0.044673, -0.101699
#*# 	-0.096878, -0.015619, 0.005457, 0.020132, 0.011646, -0.005650, -0.022921, -0.043776, -0.096017
#*# 	-0.085809, -0.034767, -0.018137, -0.004484, 0.009595, -0.005466, -0.032271, -0.037721, -0.095259
#*# 	-0.069775, -0.015524, 0.001664, 0.008630, 0.002144, -0.012607, -0.035336, -0.061027, -0.112853
#*# 	0.042585, 0.077037, 0.083887, 0.094595, 0.084988, 0.074258, 0.053165, 0.039853, -0.006207
#*# 	0.062985, 0.106129, 0.106132, 0.110105, 0.089492, 0.079814, 0.069454, 0.055102, 0.028742
#*# x_count = 9
#*# y_count = 9
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 15.0
#*# max_x = 235.0
#*# min_y = 15.0
#*# max_y = 239.96000000000004
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 15.240
#*# pid_ki = 0.668
#*# pid_kd = 86.868
#*#
#*# [probe_eddy_current btt_eddy]
#*# reg_drive_current = 15
#*# calibrate =
#*# 	0.050000:3197976.716,0.090000:3197534.213,0.130000:3196804.637,
#*# 	0.170000:3196092.950,0.210000:3195395.864,0.250000:3194707.031,
#*# 	0.290000:3194024.293,0.330000:3193377.071,0.370000:3192696.145,
#*# 	0.410000:3192082.969,0.450000:3191459.870,0.490000:3190825.306,
#*# 	0.530000:3190221.858,0.570000:3189641.465,0.610000:3189027.949,
#*# 	0.650000:3188458.387,0.690000:3187884.603,0.730000:3187344.458,
#*# 	0.770000:3186775.274,0.810000:3186262.071,0.850000:3185718.439,
#*# 	0.890000:3185214.009,0.930000:3184718.737,0.970000:3184198.581,
#*# 	1.010000:3183699.306,1.050000:3183234.558,1.090000:3182758.958,
#*# 	1.130000:3182299.795,1.170000:3181841.083,1.210000:3181393.965,
#*# 	1.250000:3180947.885,1.290000:3180496.433,1.330000:3180082.338,
#*# 	1.370000:3179666.210,1.410000:3179263.439,1.450000:3178841.902,
#*# 	1.490000:3178453.211,1.530000:3178067.696,1.570000:3177691.376,
#*# 	1.610000:3177325.509,1.650000:3176955.274,1.690000:3176593.033,
#*# 	1.730000:3176237.583,1.770000:3175882.437,1.810000:3175549.381,
#*# 	1.850000:3175191.721,1.890000:3174859.036,1.930000:3174531.057,
#*# 	1.970000:3174212.447,2.010000:3173912.314,2.050000:3173609.118,
#*# 	2.090000:3173282.638,2.130000:3172993.255,2.170000:3172693.355,
#*# 	2.210000:3172405.845,2.250000:3172126.463,2.290000:3171837.017,
#*# 	2.330000:3171601.006,2.370000:3171318.036,2.410000:3171034.904,
#*# 	2.450000:3170788.976,2.490000:3170538.319,2.530000:3170295.261,
#*# 	2.570000:3170033.578,2.610000:3169797.682,2.650000:3169558.984,
#*# 	2.690000:3169326.803,2.730000:3169093.513,2.770000:3168862.116,
#*# 	2.810000:3168648.813,2.850000:3168414.557,2.890000:3168210.819,
#*# 	2.930000:3167993.850,2.970000:3167780.412,3.010000:3167569.067,
#*# 	3.050000:3167365.449,3.090000:3167165.026,3.130000:3166972.430,
#*# 	3.170000:3166778.403,3.210000:3166575.081,3.250000:3166390.974,
#*# 	3.290000:3166209.436,3.330000:3166030.008,3.370000:3165862.437,
#*# 	3.410000:3165679.507,3.450000:3165490.524,3.490000:3165313.718,
#*# 	3.530000:3165154.161,3.570000:3164993.277,3.610000:3164824.292,
#*# 	3.650000:3164667.245,3.690000:3164524.252,3.730000:3164342.394,
#*# 	3.770000:3164204.750,3.810000:3164044.406,3.850000:3163902.531,
#*# 	3.890000:3163741.484,3.930000:3163612.038,3.970000:3163464.895,
#*# 	4.010000:3163295.817,4.050000:3163176.022
#*#
#*# [temperature_probe btt_eddy]
#*# calibration_temp = 31.832283
#*# drift_calibration =
#*# 	3210131.745312, -1643.551326, 19.953891
#*# 	3187312.655112, -643.736529, 6.866660
#*# 	3180208.990603, -464.216002, 4.744931
#*# 	3176569.660839, -429.710861, 4.439871
#*# 	3171822.810606, -304.867819, 2.873347
#*# 	3169254.047177, -275.318021, 2.555599
#*# 	3166191.608090, -201.760400, 1.654283
#*# 	3164645.735490, -195.211561, 1.625487
#*# 	3161901.695701, -112.465879, 0.589407
#*# drift_calibration_min_temp = 31.256056474171235
#*#
#*# [input_shaper]
#*# shaper_type_x = ei
#*# shaper_freq_x = 51.0
